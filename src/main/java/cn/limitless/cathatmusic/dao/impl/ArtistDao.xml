<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.limitless.cathatmusic.dao.ArtistDao">
    <resultMap id="artistResultMap" type="cn.limitless.cathatmusic.entity.Artist">
        <id column="id" property="id"/>
        <result column="created_time" property="createdTime"/>
        <result column="updated_time" property="updatedTime"/>
        <result column="name" property="name"/>
        <result column="remark" property="remark"/>
        <result column="status" property="status" javaType="cn.limitless.cathatmusic.enums.ArtistStatus"/>
        <collection select="findPhotoInfo" property="photo" column="photo_id"
                    javaType="cn.limitless.cathatmusic.entity.File"/>
        <collection select="findMusicList" property="musicList" column="id" javaType="java.util.ArrayList"
                    ofType="cn.limitless.cathatmusic.entity.Music"/>
        <collection column="created_by_user_id" select="findCreatedBy" property="createdBy"
                    javaType="cn.limitless.cathatmusic.entity.User"/>
        <collection column="updated_by_user_id" select="findUpdatedBy" property="updatedBy"
                    javaType="cn.limitless.cathatmusic.entity.User"/>
    </resultMap>

    <select id="findCreatedBy" resultMap="cn.limitless.cathatmusic.dao.UserDao.userResultMap">
        select *
        FROM user
        WHERE id = #{created_by_user_id};
    </select>
    <select id="findUpdatedBy" resultMap="cn.limitless.cathatmusic.dao.UserDao.userResultMap">
        select *
        FROM user
        WHERE id = #{updated_by_user_id};
    </select>
    <select id="findPhotoInfo" resultMap="cn.limitless.cathatmusic.dao.FileDao.fileResultMap">
        SELECT *
        FROM file
        WHERE id IN (
            SELECT photo_id AS id
            FROM artist
            WHERE id = #{photo_id}
        )
    </select>
    <select id="findMusicList" resultMap="cn.limitless.cathatmusic.dao.MusicDao.musicResultMap">
        SELECT *
        FROM music
        WHERE EXISTS(SELECT music_id as id
                     FROM artist_music
                              INNER JOIN `artist` ON `artist`.id = artist_music.artist_id AND `artist`.id = #{id}
                  )
    </select>

</mapper>